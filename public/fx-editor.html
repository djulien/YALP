<!DOCTYPE html>
<!-- from https://github.com/ajaxorg/ace-builds/blob/master/editor.html -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <link href="./css/yalp.css" rel="stylesheet" type="text/css" comment="main styles/theme" xcomment="this one last (overwrites others)" />
  </style>
</head>
<body>
    <canvas id="fx-canvas" width="480" height="480">Your browser doesn't support HTML5 canvas.</canvas>
<!--
<pre id="editor">function foo(items) {
    var i;
    for (i = 0; i &lt; items.length; i++) {
        alert("Ace Rocks " + items[i]);
    }
}</pre>
<xtextarea id="xeditor">text here</xtextarea>
-->
<div id="javascript-editor" class="editor">
/*
var canvas = document.getElementById("fx-canvas");
var ctx = canvas.getContext("2d");

for (var x = 0.5; x < 501; x += 10)
{
  ctx.moveTo(x, 0);
  ctx.lineTo(x, 381);
}

for (var y = 0.5; y < 381; y += 10) {
  ctx.moveTo(0, y);
  ctx.lineTo(500, y);
}

ctx.moveTo(0,0);
ctx.lineTo(380,380);

ctx.strokeStyle = "#ddd";
ctx.stroke();
*/
</div>
<div id="statusBar">ace status bar</div>
<button id="save" onclick="save();">Save</button>

<xscript src="./js/ace.js" type="text/javascript" charset="utf-8"></xscript>
<xscript src="./js/ext-statusbar.js"></xscript>
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script src="/socket.io/socket.io.js" xsrc="./js/socket.io.js" type="text/javascript" charset="utf-8"></script>
<script src="./js/uibundle.js" type="text/javascript" ></script>
<script>
var timer = setTimeout(function() { alert("UI main logic failed to load"); }, 1000);

//from https://github.com/thlorenz/brace/blob/master/example/javascript-editor.js
//for brace example see https://github.com/thlorenz/brace
//for ace api see https://ace.c9.io/#nav=howto
/*
//these are already bundled:
var ace = require('brace');
require('brace/mode/javascript');
require('brace/theme/monokai');
//require('brace/keybinding/vim');
var StatusBar = require("brace/ext/statusbar").StatusBar;
*/

//ace api see https://ace.c9.io/#nav=howto
var editor = ace.edit('javascript-editor');
editor.$blockScrolling = Infinity; //prevent console warnings
editor.getSession().setMode('ace/mode/javascript');
//editor.session.setMode("ace/mode/html");
editor.setTheme('ace/theme/monokai');
//editor.setTheme("ace/theme/twilight");
//editor.setTheme("ace/theme/dawn");
//https://github.com/ajaxorg/ace/blob/master/demo/statusbar.html
//var StatusBar = ace.require("./statusbar").StatusBar;
//TODO var statusBar = new StatusBar(editor, document.getElementById("statusBar")); // create a simple selection status indicator
//editor.setKeyboardHandler('ace/keyboard/vim');
editor.commands.addCommand(
{
    name: 'myCommand',
    bindKey: {win: 'Ctrl-X',  mac: 'Command-X'},
    exec: function(editor)
    {
        eval(editor.getValue()); // or session.getValue
//        save(); //alert("save");
    },
    readOnly: false //true // false if this command should not apply in readOnly mode
});

if (false)
editor.setValue([
    '// JavaScript'
  , 'var a = 3;'
  , ''
  , '// below line has an error which is annotated'
  , 'var b ='
  ].join('\n')
);
editor.clearSelection();

    var dirty = false;
//alert(editor? "have editor": "NO editor");
//alert("val " + editor.getValue());
//var buf = '';
//for (var i in editor) if (editor[i]) buf += ', ' + i;
//console.log("editor", editor, buf);
    function dirty(on)
    {
        document.getElementById('save').enabled
    }
    editor.getSession().on('change', function(e) { dirty = true; });
    function save()
    {
        var text = editor.getValue(); // or session.getValue
        alert("TODO: save text len " + text.length);
    }
    // e.type, etc

clearTimeout(timer); timer = null;
console.log("loaded okay");
</script>

<xscript src="./js/show_own_source.js"></xscript>

</body>
</html>