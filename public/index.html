<!DOCTYPE html>
<!--
YALP: Yet Another Lightshow Player
JavaScript - not the right tool for the job?
Check these out:
- http://www.html5rocks.com/en/tutorials/webgl/million_letters/
- http://www.npmjs.com/package/serialport or serialport2
For more info about YALP, see http://
-->
<html lang="en">
    <head>
        <!-- meta charset="utf-8" / -->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <xmeta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <title>YALP! - Yet Another Lightshow Player</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" comment="TODO: set width?" />
        <xlink href="lib/font-awesome-4.3.0/css/font-awesome.min.css" rel="stylesheet" comment="icons" />
        <xlink href="lib/w2ui/w2ui-1.4.2.css" rel="stylesheet" type="text/css" comment="this one first" />
        <link href="./css/yalp.css" rel="stylesheet" type="text/css" comment="main styles/theme" xcomment="this one last (overwrites others)" />
        <link href="./css/user.css" rel="stylesheet" type="text/css" comment="main styles/theme" xcomment="this one last (overwrites others)" />
        <xscript src="lib/require/require-2.1.17.js" xsrc="./js/yalp.js" data-main="js/main" type="text/javascript"></xscript>
        <xscript src="node_modules/jquery/dist/jquery.js" type="text/javascript" comment="kludge: make global to avoid dependency problems"></xscript>
        <xscript src="./bundles/shared.js" type="text/javascript" xid="main" comment="shared modules"></xscript>
        <xscript src="./bundles/yalp.js" type="text/javascript" xid="main" comment="loader for top-level plug-ins"></xscript>
        <script src="http://code.jquery.com/jquery-latest.min.js" comment="TODO: drop this or assume it is cached from cdn?"></script>
        <xscript src="/socket.io/socket.io.js" xsrc="./js/socket.io.js" type="text/javascript" charset="utf-8"></xscript>
        <xscript src="http://cdn.jsdelivr.net/sockjs/1.0.1/sockjs.min.js" comment="websocket api; promote cdn sharing"></xscript>
        <xscript src="/reload/reload.js"></xscript>
        <xscript src="/js/yalpui-bundled.js" type="text/javascript" xid="main" comment="ui loader; auto-generated (browserify)"></xscript>
<script src="socket.io/socket.io.js"></script>
<script src="term.js" comment="TODO: remap to /js?"></script>
<script src="options.js" comment="TODO: remap to /js?"></script>
<script src="/js/tty.js"></script>
<script src="/js/user.js" comment="user extensions"></script>
        <script type="text/javascript" charset="utf-8">
            elapsed();
            function elapsed()
            {
                if (!elapsed.started) elapsed.started = Date.now();
                return Date.now() - elapsed.started; //msec
            }
            const svtitle = document.title;
            ["connect", "open tab", "load", "open", "reset", "open window", "focus window", "focus", "close window", "drag window", "minimize window", "maximize window", "resize window", "focus tab", "resize tab", "close tab"].forEach(function(name) { tty.on(name, function() { console.log("evt: " + name, '@' + elapsed()); }); }); //new tty.Window(); });

                tty.once('open tab', function(tab)
                {
                    console.log("got tab", '@' + elapsed());
//                    tab.setProcessName('YALP');
                    tab.write("Welcome to YALP!\n");
                    document.title = svtitle; //set 
                });
//  this.use(express.favicon(__dirname + '/../static/favicon.ico'));

            tty.on('connect', function()
            {
console.log("cre w in", '@' + elapsed());
                var w = new tty.Window(); //NOTE: windows will be destroyed on connect, so do this after
console.log("cre w out", '@' + elapsed());
            });
            $(document).ready(function()
            {
                console.log( "dom ready!", '@' + elapsed());
//		new tty.Window();
//		setTimeout(function() { console.log("new w0", '@' + elapsed()); new tty.Window(); console.log("new w1", '@' + elapsed()); }, 100); //kludge: window won't open until a little while after DOM is ready
/*
		console.log("found ", $('#open').length, " Open buttons");
		var btn = document.getElementById('open');
		if (!btn) { alert("no Open button?"); return; }
		btn.onclick = function() { console.log("nope"); btn.has_handler = false; }
		var retry = 0;

		delayed_open(function()
		{
//			$('#open').trigger('click'); //open a tty window; tty.js doesn't expose the function, so simulate a user click
//			btn.click();
			console.log("Open click");
		});

		function delayed_open(cb)
		{
//			var btn = $("#open")[0];
//			var evh = $._data(btn, 'events');
			btn.has_handler = true;
//			var evh = document.getElementById('open');
//		        if (evh && evh.onclick) cb(); //alert('click bound to this button');
			if (!btn.has_handler) { console.log("error"); return; }
			btn.click();
			if (btn.has_handler) { cb(); return; }
			console.log("waiting for button", ++retry);
			setTimeout(function() { delayed_open(cb); }, 1000);
		}
*/
            });
        </script>
    </head>
    <body>
<!--    Hello from YALP! <hr/> -->
<!--
<div id="help">
  <p>Click the titlebar to drag.</p>
  <p>Double-click titlebar to maximize.</p>
  <p>Click the lower-right corner to resize.</p>
  <p>Click the tilde to open a new tab.</p>
  <p>Click the tilde with a modifier to close the window.</p>
</div>
<button id="open">Open Terminal</button>
<button id="lights">Light Switch</button>
-->
        <xdiv id="tty-log"></xdiv>
        <div class="fatal">
            <noscript>
                <h1>ERROR: YALP needs JavaScript.</h1>
                <p>This app requires JavaScript to be enabled in your browser.</p>
                <p>Here are some things to try:</p>
                <ul>
                    <li><a href="http://enable-javascript.com/">Instructions to enable JavaScript</a>.</li>
                    <li>Ensure that you have a <a href="http://outdatedbrowser.com/en">recent browser version</a>.</li>
                    <li>Turn off or disable any NoScript extensions that you might have.</li>
                </ul>
            </noscript>
        </div>
    </body>
</html>
