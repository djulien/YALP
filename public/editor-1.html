<!DOCTYPE html>
<!-- from https://github.com/ajaxorg/ace-builds/blob/master/editor.html -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <link href="./css/yalp.css" rel="stylesheet" type="text/css" comment="main styles/theme" xcomment="this one last (overwrites others)" />
  </style>
</head>
<body>

<!--
<pre id="editor">function foo(items) {
    var i;
    for (i = 0; i &lt; items.length; i++) {
        alert("Ace Rocks " + items[i]);
    }
}</pre>
<xtextarea id="xeditor">text here</xtextarea>
-->
<div id="javascript-editor" class="editor"></div>
<div id="statusBar">ace status bar</div>
<canvas id="tutorial" width="400" height="400" style="position: absolute; top: 10px; left: 200px; z-index: 99;"></canvas>
<button id="save" onclick="save();">Save</button>

<xscript src="./js/ace.js" type="text/javascript" charset="utf-8"></xscript>
<xscript src="./js/ext-statusbar.js"></xscript>
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script src="/socket.io/socket.io.js" xsrc="./js/socket.io.js" type="text/javascript" charset="utf-8"></script>
<script src="./js/uibundle.js" type="text/javascript" ></script>
<script id="source">
    console.clear();
    var canvas = document.getElementById('tutorial');
//        if (canvas.getContext){
    var ctx = canvas.getContext('2d');

/*
    ctx.fillStyle = "rgb(200, 0, 0)";
    ctx.fillRect (10, 10, 55, 50);
    ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
    ctx.fillRect (30, 30, 55, 50);

    ctx.fillRect(25,25,100,100);
    ctx.clearRect(45,45,60,60); //xparent
    ctx.strokeRect(50,50,50,50);

    ctx.beginPath();
    ctx.moveTo(75,50); //must be first command after beginPath
    ctx.lineTo(100,75);
    ctx.lineTo(100,25);
    ctx.fill();

   // Filled triangle
    ctx.beginPath();
    ctx.moveTo(125,25);
    ctx.lineTo(205,25);
    ctx.lineTo(125,105);
    ctx.fill();

    // Stroked triangle
    ctx.beginPath();
    ctx.moveTo(225,125);
    ctx.lineTo(225,45);
    ctx.lineTo(145,125);
    ctx.closePath();
    ctx.stroke();
*/

    ctx.strokeStyle = "rgb(200, 100, 50)";
    ctx.moveTo(0, 0);
    ctx.lineTo(0, 100);
    ctx.stroke();

//var myImageData = ctx.createImageData(10, 10); //w, h
var myImageData = ctx.getImageData(0, 0, 10, 10); //left, top, width, height);
var buf = myImageData.data; //Uint8ClampedArray of RGBA values
console.log("w %d, h %d, len %d:", myImageData.width, myImageData.height, buf.length, buf);
</script>

<script>
var timer = setTimeout(function() { alert("UI main logic failed to load"); }, 1000);

//from https://github.com/thlorenz/brace/blob/master/example/javascript-editor.js
//for brace example see https://github.com/thlorenz/brace
//for ace api see https://ace.c9.io/#nav=howto
/*
//these are already bundled:
var ace = require('brace');
require('brace/mode/javascript');
require('brace/theme/monokai');
//require('brace/keybinding/vim');
var StatusBar = require("brace/ext/statusbar").StatusBar;
*/

//ace api see https://ace.c9.io/#nav=howto
var editor = ace.edit('javascript-editor');
editor.$blockScrolling = Infinity; //prevent console warnings
editor.getSession().setMode('ace/mode/javascript');
//editor.session.setMode("ace/mode/html");
editor.setTheme('ace/theme/monokai');
//editor.setTheme("ace/theme/twilight");
//editor.setTheme("ace/theme/dawn");
//https://github.com/ajaxorg/ace/blob/master/demo/statusbar.html
//var StatusBar = ace.require("./statusbar").StatusBar;
//TODO var statusBar = new StatusBar(editor, document.getElementById("statusBar")); // create a simple selection status indicator
//editor.setKeyboardHandler('ace/keyboard/vim');
var repl = {}; //sandbox
editor.commands.addCommand(
{
    name: 'myCommand',
    bindKey: {win: 'Ctrl-X',  mac: 'Command-X'},
    exec: function(editor)
    {
//        save(); //alert("save");
        eval.call(repl, editor.getValue()); // or session.getValue
    },
    readOnly: false //true // false if this command should not apply in readOnly mode
});

//editor.setValue([
//    '// JavaScript'
//  , 'var a = 3;'
//  , ''
//  , '// below line has an error which is annotated'
//  , 'var b ='
//  ].join('\n')
//);
editor.setValue(document.getElementById('source').innerHTML);
editor.clearSelection();

    var dirty = false;
//alert(editor? "have editor": "NO editor");
//alert("val " + editor.getValue());
//var buf = '';
//for (var i in editor) if (editor[i]) buf += ', ' + i;
//console.log("editor", editor, buf);
    function dirty(on)
    {
        document.getElementById('save').enabled
    }
    editor.getSession().on('change', function(e) { dirty = true; });
    function save()
    {
        var text = editor.getValue(); // or session.getValue
        alert("TODO: save text len " + text.length);
    }
    // e.type, etc

clearTimeout(timer); timer = null;
console.log("loaded okay");
</script>

<xscript src="./js/show_own_source.js"></xscript>

</body>
</html>
